# ...informator...


## API документооборота

Доступ ко всем маршрутам API документов осуществяется с использованием access токена.

Все роуты, кроме поиска документов, могут возвращать ошибку 403 если пользователь пытается взаимодействовать с типом документов, доступ к которым запрещён.

Маршруты действий (редактирование, удаление, подписание документов) дополнительно выполняют проверку доступности действий, разрешённых для пользователя. К примеру пользователь не сможет подписать документ, если в настройках его роли не установлено такое действие.

Маршруты, которые предполагают использование id документа при запросе могут возвращать ошибку 404 если документ отсутствует в БД.

##### Поиск документов

Маршрут:
```
GET /api/informator/docflow/search/doc
GET /api/informator/docflow/search/doc/count
```

Параметры:
- search (строка запроса для поиска документа по тексту)
- last (id последнего полученного объекта)
- limit (кол-во объектов в ответе)
- acceptor (0 - не подписал,  1 - подписал, 2 - в списке утверждающих)
- recipient (0 - не подписал,  1 - подписал, 2 - в списке согласователей)
- author (если 1 - то ищет user в авторах)
- directing (id направления для документа)
- task (id типа документа)

Поиск возвращает документы, доступные для пользователя. Доступность определяется на основе установленных прав доступа для роли. 
Если передаётся параметр `directing` - возвращаются документы только этого направления.
Если передаётся параметр `task` - возвращаются документы только этого типа.
Если передаётся параметр `acceptor` - возвращаются документы только этого направления.

##### Получение документа по id 

Маршрут:
```
GET /api/informator/docflow/:id
```
где `:id` - идентификатор документа

##### Создание документа

Маршрут:
```
POST /api/informator/docflow
```

##### Изменение документа

Маршрут:
```
PATCH /api/informator/docflow/:id
```
где `:id` - идентификатор документа

Обновляет поля документа:
- название
- описание
- список, прикреплённых файлов
- массив полоьзователей для утверждения документа
- массив полоьзователей для согласования документа

##### Удаление документа

Маршрут:
```
DELETE /api/informator/docflow/:id
```
где `:id` - идентификатор документа

##### Удаление файлов, прикреплённых к документу

Маршрут:
```
PATCH /api/informator/file/:id
```
где `:id` - идентификатор документа

##### Утверждение документа

Маршрут:
```
PATCH /api/informator/accepting/:id
```
где `:id` - идентификатор документа

##### Согласование документа

Маршрут:
```
PATCH /api/informator/recipienting/:id
```
где `:id` - идентификатор документа







## API пользователей

Доступ ко всем маршрутам API документов осуществяется с использованием access токена в котором передаётся email пользователя. Это означает, что пользователь работает только со своими данными.

##### Поиск пользователей

Маршрут:
```
GET /api/informator/user/search
```

Параметры:
- search (строка запроса для поиска по полному имени)
- last (id последнего полученного объекта)
- limit (кол-во объектов в ответе)
- directing (id направления для документа)
- task (id типа документа)
- acceptor (если 1 - может подписывать документ. Работает только в паре с комбинацией параметров directing и task)
- recipient (если 1 - может подписывать документ. Работает только в паре с комбинацией параметров directing и task)

Если передаются параметры `directing` и `task` без параметров `acceptor`/`recipient`, то возвращает пользователей, которые могут взаимодействовать с данным типом документа.
Если передаются параметры `directing` и `task`  вместе с `acceptor` и `recipient`, то возвращает пользователей, которые могут утверждать или согласовывать данный тип документа.

##### Получение пользователя

Маршрут:
```
GET /api/informator/user
```

##### Создание пользователя

Маршрут:
```
POST /api/informator/user
```

При создании

##### Изменение данных о пользователе

Маршрут:
```
PATCH /api/informator/user
```

Обновляет данные пользователя:
- Ф.И.О. пользователя

##### Удаление пользователя

Маршрут:
```
DELETE /api/informator/user
```

##### Изменение аватарки пользователя

Маршрут:
```
PATCH /api/informator/user/photo
```

## API ролей, направлений, типов документов

Все CRUD API для ролей, направлений, типов документов однотипны и различаются только префиксом для обращений.

Прификсы:
- API ролей: `/api/informator/role`
- API направлений: `/api/informator/directing`
- API типов документов: `/api/informator/task`

> Прим.: далее префикс будет обозначаться как `{prefix}`

##### Получение всех записей

Маршрут:
```
GET {prefix}
```

##### Получение записи по id 

Маршрут:
```
GET {prefix}/:id
```
где `:id` - идентификатор записи

##### Создание записи

Маршрут:
```
POST {prefix}
```

При создании

##### Изменение записи

Маршрут:
```
PATCH {prefix}/:id
```
где `:id` - идентификатор записи

##### Удаление записи

Маршрут:
```
DELETE {prefix}/:id
```
где `:id` - идентификатор записи


## API действий

Список действий создаётся автоматически при создании БД скриптами или при запуске контейнера docker. Данный список не должен изменяться, т.к. это может поломать всю систему ролей. Поэтому в данном API доступен только один маршрут - получение всех действий.

##### Получение всех действий

Маршрут:
```
GET /api/informator/action
```


## API для информации о компании

CRUD API для работы со списком данных позволяет создавать, запрашивать, изменять и удалять данные.
При обращениях к API сервер возвращает данные в формате json. В зависимости от состояния ответа, возвращаемая структура может содержать данные, либо ошибки.

##### Создание записи

Маршрут:
```
POST /api/informator/about
```

Сервер ожидает получить текстовые данные в формате markdow и алиас страницы, доступный по ключу `alias`.
В случае успешного добавления данных сервер ответит статусом **201** и вернёт данные о созданном поставщике в формате json.

```js
{
  alias: "псевдоним страницы",
  markdown: "данные страницы в формате markdown"
}
```

##### Получение данных

Маршрут:
```
GET /api/informator/about
```

Сервер возвращает статус **200** и массив объектов с данными в формате json.

```js
[
  {
    alias: "псевдоним страницы",
    markdown: "данные страницы в формате markdown"
  },
  {
    alias: "псевдоним страницы",
    markdown: "данные страницы в формате markdown"
  },
  ...
]
```

##### Получение данных определённой страницы

Маршрут:
```
GET /api/informator/about/:alias
```
где `:alias` - псевдоним страницы

В случае если поставщик, под запрашиваемым идентификатором существует, сервер вернёт сатус **200** и данные бренда в формате json.

```js
{
  alias: "псевдоним страницы",
  markdown: "данные страницы в формате markdown"
}
```

Если запрашиваемая страница не существует, сервер ответит статусом **404** с описанием возникшей ошибки.

##### Изменение данных страницы

Маршрут:
```
PATCH /api/informator/about/:alias
```
где `:alias` - псевдоним страницы

В случае успешного изменения данных страницы сервер ответит статусом **200** и вернёт обновлённые данные о поставщике в формате json.

```js
{
  alias: "псевдоним страницы",
  markdown: "данные страницы в формате markdown"
}
```

Если запрашиваемая страница не существует, сервер ответит статусом **404** с описанием возникшей ошибки.

##### Удаление данных страницы

Маршрут:
```
DELETE /api/informator/about/:alias
```
где `:alias` - псевдоним страницы

В случае успешного удаления данных страницы сервер ответит статусом **200** и вернёт данные об удалённом поставщике в формате json.

```js
{
  alias: "псевдоним страницы",
  markdown: "данные страницы в формате markdown"
}
```

Если удаляемая страница не существует, сервер ответит статусом **404** с описанием возникшей ошибки.


